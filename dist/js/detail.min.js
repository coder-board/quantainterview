!function(){Vue.config.devtools=!1,Vue.use(Vue.resource);var t=new Vue({el:"body",data:{status:{isLoading:!0,unSaved:!1},modal:{isModal:!1,success:"",text:""},url:{actionUrl:"",freshUrl:"",backUrl:"./overview.html"},depart:[],mainData:{master:"",name:"",itv_code:"",phone:"",email:"",class:"",other_depart:0,first_will:2,second_will:0,fir_result:"",fir_comment:"",fir_grade:"",sec_comment:"",sec_grade:"",sec_result:0}},ready:function(){this.getDepart(),this.render(),this.getParam("itv_code")?this.url.actionUrl="../phpCtrl/update.php":this.url.actionUrl="../phpCtrl/insert.php"},watch:{"status.unSaved":function(t){window.onbeforeunload=function(){if(1==t)return event.returnValue="页面尚未保存",!1}}},methods:{getDepart:function(){this.$http.get("../phpCtrl/getFormGroup.php").then(function(t){this.$set("depart",t.json().data.depart)})},getParam:function(t){var e=location.search;if(e.indexOf("?")==-1)return"";e=e.substr(1,e.length).split("&");for(var s,a=0,r=e.length;a<r;a++)if(s=e[a].split("="),s[0]==t)return s[1]},render:function(){var t=this.getParam("itv_code");t?json={emulateJSON:!0,params:{itv_code:t}}:json={},this.$http.get("../phpCtrl/detail.php",json).then(function(t){1==t.json().result?(this.status.isLoading=!1,this.$set("mainData",t.json().data),this.url.backUrl="./overview.html?department="+t.json().data.first_will):100==t.json().result?(this.status.isLoading=!1,this.mainData.master=t.json().data.master):t.json().result==-1?location.href="./login.html":(alert("请求出现异常，请重新登录"),location.href="./login.html")})},hasModified:function(){this.status.unSaved=!0},onSubmit:function(){this.status.unSaved&&this.$http.post(this.url.actionUrl,this.mainData,{emulateJSON:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(t){1==t.json().result?(this.status.unSaved=!1,this.onModal(t.json().msg,"success"),t.json().data.first_will&&(this.url.freshUrl="./detail.html?itv_code="+t.json().data.itv_code,this.url.backUrl="./overview.html?department="+t.json().data.first_will)):this.onModal(t.json().msg)})},back:function(){location.href=this.url.backUrl},onModal:function(t,e){this.modal.success=!1,this.modal.text=t,this.modal.isModal=!0,e&&"success"==e&&(this.modal.success=!0)},offModal:function(){this.modal.isModal=!1,this.url.actionUrl.indexOf("insert.php")!=-1&&this.url.freshUrl&&(location.href=this.url.freshUrl)}}});Vue.filter("toDepartment",function(e){var s=t.depart;for(var a in s)if(s[a].depart_id==e)return s[a].depart_name;return"无"}),Vue.filter("toResult",function(t){switch(t){case"3":return"通过";case"2":return"待定";case"1":return"不通过";default:return"无记录"}})}();